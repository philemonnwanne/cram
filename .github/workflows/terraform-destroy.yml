name: 💣 Destroy AZURE App 💥
run-name: destruction by ${{ github.actor }} 🧨
on:
  workflow_run:
    # workflows: [terraform-create]
    workflows: [terraform MOC]
    types: 
      - completed
  workflow_dispatch:
    inputs:
      action:
        description: "Destroy Infra?"
        type: choice
        options:
          - destroy_No
          - destroy_Yes
  # workflow_call:
  # push:

defaults:
  run:
    working-directory: "./azure"

permissions:
  id-token: write # required for requesting the JWT
  contents: read # required for actions/checkout

jobs:
  destroy_job:
    name: 🐢 Terraform Infrastructure MOC 🐧
    strategy:
      matrix:
        os: [ubuntu-latest]
        # environment: [ stage, prod ]
    runs-on: ${{ matrix.os }}
    # environment: ${{ matrix.environment }}
    env:
      ACTOR: ${{ github.actor }}

    steps:
      - name: Terraform Destroy
        if: ${{ github.event.workflow_run.actor == env.ACTOR }}
        run: echo "terraform destroy achieved"

        # if: ${{ github.event.workflow_run.actor == env.ACTOR && github.event.inputs.action == 'destroy_Yes' }}