name: 👨🏾‍🎤 terraform MOC 🧌
run-name: action by ${{ github.actor }} 🧌
on:
  workflow_dispatch:
  push:
    branches:
      - "main"

permissions:
  id-token: write # required for requesting the JWT
  contents: read # required for actions/checkout
  pull-requests: write

jobs:
  static_test:
    name: Perform lint/static Tests
    # needs: infracost_job
    # if: ${{ failure() }}
    uses: ${GITHUB_WORKSPACE}/.github/workflows/static-test.yml@main
    secrets: inherit

  build:
    name: Build Artifacts/Docker Image & Push to ECR
    # needs: infracost_job
    # if: ${{ failure() }}
    needs: static_test
    uses: ${GITHUB_WORKSPACE}/.github/workflows/build.yml@main
    secrets: inherit

  # integration_test:
  #   name: Run Integration Tests
  #   needs: [static_test, build]
  #   uses: ${GITHUB_WORKSPACE}/.github/workflows/integration-test.yml@main
  #   secrets: inherit

  # deploy_stage:
  #   name: Deploy to Staging Environment 🕋
  #   needs: [build, integration_test]
  #   uses: ${GITHUB_WORKSPACE}/.github/workflows/deploy-stage.yml@main
  #   secrets: inherit

  # deploy_prod:
  #   name: ⛅️ Deploy to Live Environment
  #   needs: deploy_stage
  #   uses: ${GITHUB_WORKSPACE}/.github/workflows/deploy-prod.yml@main
  #   secrets: inherit

  # deploy:
  #   name: Deploy to Staging and Production Environments 🕋
  #   needs: integration_test
  #   uses: ${GITHUB_WORKSPACE}/.github/workflows/deploy.yml@main
  #   secrets: inherit
