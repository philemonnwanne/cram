# export TF_WORKSPACE="$(terraform workspace show)"
run-name: creation by ${{ github.actor }} 🪼
on:
  workflow_dispatch:
  push:

jobs:
  space1:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Terraform 🚦
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_wrapper: true

      - name: Terraform Workspace 🪐 # create and switch to new workspace
        id: workspace
        run: |
          terraform workspace new stage
          echo "TF_WORKSPACE="$(terraform workspace show)"" >> "$GITHUB_ENV"

      - name: Use the value
        id: step_two
        run: printf '%s\n' "$TF_WORKSPACE"

  space2:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Terraform 🚦
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_wrapper: true

      - name: Terraform Workspace 🌍 # create and switch to new workspace
        id: workspace
        run: |
          terraform workspace new stage
          echo "TF_WORKSPACE="$(terraform workspace show)"" >> "$GITHUB_OUTPUT"
        
      - name: Get workspace
        env:
          TF_WORKSPACE: ${{ steps.workspace.outputs.TF_WORKSPACE }}
        run: echo "The selected workspace is $TF_WORKSPACE"